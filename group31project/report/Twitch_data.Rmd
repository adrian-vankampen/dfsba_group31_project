## EDA for Twitch data-set

These data comes from the website : [Twitchtracker](https://twitchtracker.com/statistics)

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source(here::here("scripts/setup.R"))
```

```{r}
data1 <- read_delim(file = here::here("data/Twitch.csv"), ";", 
                    escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
```

Let's first load the dataset :

```{r}
# Data cleaning

TwitchData <- data1 %>%
  # set a name for each variable
  rename(Date = X1, Avg_concur_viewers = X2, 
         Avg_concur_channels = X3, Hours_watched = X4, 
         Active_streamers = X5, Hours_streamed = X6) %>%
  # modify the format of certain variable
  mutate(Date = mdy(Date), 
         Hours_watched = parse_number(Hours_watched)*1000000,
         Hours_streamed = Hours_streamed*10) %>%
  # Replace value with NA (in our dataframe, n/a are considered as character)
  replace_with_na(replace = list(Active_streamers = "n/a")) %>%
  mutate(Viewers_per_streamer = Hours_watched*100000000/Hours_streamed) %>%
  # Convert the column from character to double
  mutate(Active_streamers = parse_number(Active_streamers))

# Data overview

TwitchData %>% 
   kbl(caption = "Twitch statistics") %>%  
   kable_paper(full_width = F) %>% 
   scroll_box(width = "100%", height = "300px")

# test 
freq.na(TwitchData)
```
<p>&nbsp;</p>
We can see that these data consist of 99 observations of 7 attributes. 

## Here is a description of each attribute :
   
- `Date` : month in which the data apply
- `Avg_concur_viewers` : Number of viewers connected in the same time in average 
- `Avg_concur_channels` : Number of channels connected in the same time in average 
- `Hours_watched` (in million) : Total number of hours watched per month
- `Active_streamers` : Total number of active channels
- `Hours_streamed` : Total number of hours streamed per month
- `Viewers_per_streamer` : Average number of viewers per streamer per month


## Here the graph for each variable :

##### Average concurent viewers for each month :

```{r}
o_Avg_concur_viewers <- TwitchData %>%
    ggplot(aes(x = Date, y = Avg_concur_viewers)) +
    geom_col() +
    ylab("Average concurent viewers")

ggplotly(o_Avg_concur_viewers, height = 400)
```

##### Average concurent channels for each month:

```{r}
o_Avg_concur_channels <- TwitchData %>% 
    ggplot(aes(x = Date, y = Avg_concur_channels)) +
    geom_col() +
    ylab("Average concurent channels")

ggplotly(o_Avg_concur_channels, height = 400)

```

##### Total number of hours watched per month :

```{r}
o_Hours_watched <- TwitchData %>% 
    ggplot(aes(x = Date, y = Hours_watched)) +
    geom_col() +
    ylab("Hours watched")

ggplotly(o_Hours_watched, height = 400)

```

##### Total number of active channels

```{r}
o_Active_streamers <- TwitchData %>% 
  ggplot(aes(x = Date, y = Active_streamers)) +
  geom_col()+
  ylab("Average streamers")

ggplotly(o_Active_streamers, height = 400)
```

##### Total number of hours streamed per month

```{r}
o_Hours_streamed <- TwitchData %>% 
  ggplot(aes(x = Date, y = Hours_streamed)) +
  geom_col()+
  ylab("Hours streamed")

ggplotly(o_Hours_streamed, height = 400)

```

##### Average number of viewers per streamer per month

```{r}
o_Viewers_per_streamer <- TwitchData %>% 
  ggplot(aes(x = Date, y = Viewers_per_streamer)) +
  geom_col()+
  ylab("Viewers per streaner") 

ggplotly(o_Viewers_per_streamer, height = 400)

fig <- plot_ly(TwitchData, x = ~TwitchData$Date, y = ~TwitchData$Hours_watched, name = 'Hours watched', type = 'scatter', mode = 'lines', height = 400) %>%
  layout(xaxis = list(title="Date"),
         yaxis = list(title=""),
         title = "Total number of active streamers",
         margin = list(b=160), ##bottom margin in pixels
         annotations = 
           list(x = 1.5, y = -0.4, #position of text adjust as needed 
                text = "*For the purposes of the graph, we have chosen to modify the scale of Hours watched and Viewers per streamers to make the plot relevant.", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=0, yshift=0,
                font=list(size = 8, color="black"))
         )
  
fig <- fig %>% add_trace(y = ~TwitchData$Hours_streamed, name = 'Hours streamed', type = 'scatter', mode = 'lines') 
fig <- fig %>% add_trace(y = ~TwitchData$Viewers_per_streamer, name = 'Viewers per streamer', type = 'scatter', mode = 'lines')
#  This graph therefore shows the general trends of the variable, the values shown are not relevant. 
fig
```
```{r}
ggplotly(TwitchData %>% 
  ggplot(aes(x = Date, y = Viewers_per_streamer)) +
  geom_col()+
  ylab("Viewers per streaner"), height = 400)
```

```{r}
bf <- TwitchData %>% separate(Date, into = c("year", "month", "day")) %>%
  filter(year >= 2017) %>% mutate(day = NULL) %>% 
  unite(Date, year, month, sep = "-") %>% 
  arrange(Date) %>% mutate(ID = 1:47)
bf$ID <- seq.int(nrow(bf))


accumulate_by <- function(dat, var) {
  var <- lazyeval::f_eval(var, dat)
  lvls <- plotly:::getLevels(var)
  dats <- lapply(seq_along(lvls), function(x) {
    cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]])
  })
  dplyr::bind_rows(dats)
}

bf <- bf %>%
  accumulate_by(~ID)

p <- ggplot(bf,aes(ID, Hours_watched, frame = frame)) +
  geom_line()

fig <- ggplotly(p, height = 400) %>%
  layout(
    title = "Hours watched",
    yaxis = list(
      title = "Total ammount",
      zeroline = F,
      tickprefix = "$"
    ),
    xaxis = list(
      title = "Month",
      zeroline = F, 
      showgrid = F
    )
  ) %>% 
  animation_opts(
    frame = 50, 
    transition = 0, 
    redraw = FALSE
  ) %>%
  animation_slider(
    currentvalue = list(
      prefix = "Month "
    )
  )

fig
```

